<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ÌÉêÏÉâÍ∏∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #fafafa;
            color: #333;
        }

        /* ÏôºÏ™Ω Ìå®ÎÑê */
        .sidebar {
            width: 1000px;
            background-color: white;
            padding: 30px 40px;
            border-right: 1px solid #e5e5e5;
            overflow-y: auto;
            max-height: 100vh;
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 30px;
            color: #000;
        }

        /* API ÌÇ§ ÏÑπÏÖò */
        .api-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .api-label {
            font-size: 12px;
            color: #999;
            min-width: 120px;
            font-weight: 600;
        }

        .api-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            font-family: monospace;
            min-width: 250px;
        }

        .btn-group {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-save {
            background-color: #ff4757;
            color: white;
            min-width: 60px;
        }

        .btn-save:hover {
            background-color: #ff3838;
        }

        .btn-delete {
            background-color: #e5e5e5;
            color: #666;
            min-width: 60px;
        }

        .btn-delete:hover {
            background-color: #d5d5d5;
        }

        /* Í≤ÄÏÉâ ÏÑπÏÖò */
        .search-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .search-label {
            font-size: 12px;
            color: #999;
            min-width: 50px;
            font-weight: 600;
        }

        .search-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            min-width: 200px;
        }

        /* ÌïÑÌÑ∞ ÏÑπÏÖò - Ïª®ÌÖåÏù¥ÎÑà */
        .filters-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .filter-section {
            display: flex;
            flex-direction: column;
        }

        .filter-title {
            font-size: 12px;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
            user-select: none;
        }

        .filter-option:hover {
            background-color: #efefef;
            border-color: #ccc;
        }

        .filter-option input[type="radio"],
        .filter-option input[type="checkbox"] {
            cursor: pointer;
            accent-color: #4caf50;
            width: 14px;
            height: 14px;
        }

        .filter-option label {
            cursor: pointer;
            margin: 0;
            font-size: 13px;
        }

        .filter-option input:checked + label {
            font-weight: 600;
            color: #4caf50;
        }

        /* Íµ¨ÎèÖÏûê ÎåÄÎπÑ Ï°∞ÌöåÏàò ÎπÑÏú® ÏÑπÏÖò */
        .engagement-section {
            grid-column: 1 / -1;
        }

        .engagement-title {
            font-size: 12px;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .engagement-info {
            font-size: 11px;
            color: #999;
            margin-bottom: 12px;
            font-style: italic;
        }

        .engagement-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Ïò§Î•∏Ï™Ω Ïª®ÌÖêÏ∏† ÏòÅÏó≠ */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 30px 40px;
            overflow-y: auto;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .content-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .controls-right {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .view-toggle {
            display: flex;
            gap: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }

        .view-btn {
            padding: 8px 12px;
            border: none;
            background: white;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: #666;
            transition: all 0.2s ease;
        }

        .view-btn.active {
            background-color: #4caf50;
            color: white;
        }

        .view-btn:hover:not(.active) {
            background-color: #f5f5f5;
        }

        .sort-dropdown {
            padding: 8px 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            background-color: white;
            cursor: pointer;
            min-width: 160px;
        }

        .btn-search {
            background-color: #4caf50;
            color: white;
            padding: 10px 24px;
            font-size: 13px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
        }

        .btn-search:hover {
            background-color: #45a049;
        }

        .btn-search:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .btn-excel {
            background-color: #1abc9c;
            color: white;
            padding: 10px 24px;
            font-size: 13px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-excel:hover {
            background-color: #16a085;
        }

        .btn-excel:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .results-count {
            font-size: 13px;
            color: #999;
            margin-bottom: 20px;
        }

        /* Ïπ¥Îìú Í∑∏Î¶¨Îìú */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
            flex: 1;
        }

        .results-grid.hidden {
            display: none;
        }

        /* ÌÖåÏù¥Î∏î Î∑∞ */
        .results-table-wrapper {
            flex: 1;
            overflow-x: auto;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            display: none;
        }

        .results-table-wrapper.active {
            display: block;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .results-table thead {
            background-color: #f5f5f5;
            position: sticky;
            top: 0;
        }

        .results-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e5e5e5;
            color: #333;
            white-space: nowrap;
        }

        .results-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e5e5;
        }

        .results-table tbody tr:hover {
            background-color: #fafafa;
        }

        .table-thumbnail {
            width: 60px;
            height: 45px;
            object-fit: cover;
            border-radius: 4px;
        }

        .table-title {
            max-width: 250px;
            word-break: break-word;
        }

        .table-link {
            color: #4caf50;
            text-decoration: none;
            font-weight: 600;
        }

        .table-link:hover {
            text-decoration: underline;
        }

        .engagement-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            white-space: nowrap;
        }

        .engagement-1 {
            background-color: #ffe5e5;
            color: #cc0000;
        }

        .engagement-2 {
            background-color: #ffe6cc;
            color: #ff6600;
        }

        .engagement-3 {
            background-color: #ffffcc;
            color: #ccaa00;
        }

        .engagement-4 {
            background-color: #ccffcc;
            color: #00aa00;
        }

        .engagement-5 {
            background-color: #ccffee;
            color: #009999;
        }

        /* Ïπ¥Îìú Î∑∞ */
        .video-card {
            background-color: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .video-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-4px);
        }

        .video-thumbnail {
            width: 100%;
            height: 130px;
            background-color: #e5e5e5;
            object-fit: cover;
            position: relative;
        }

        .video-duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 2px;
            font-size: 11px;
            font-weight: 600;
        }

        .video-info {
            padding: 12px;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .video-title {
            font-size: 12px;
            font-weight: 600;
            color: #000;
            margin-bottom: 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.4;
        }

        .video-channel {
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
        }

        .video-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-bottom: 8px;
            font-size: 11px;
            color: #999;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .video-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            margin-bottom: 8px;
        }

        .tag {
            background-color: #f0f0f0;
            color: #666;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
        }

        .video-link {
            display: inline-block;
            color: #4caf50;
            text-decoration: none;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            margin-top: auto;
        }

        .video-link:hover {
            text-decoration: underline;
        }

        /* Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà */
        .main-container {
            display: flex;
            min-height: 100vh;
        }

        .status {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-size: 14px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4caf50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background-color: #ff4757;
            color: white;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 12px;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-size: 14px;
        }

        /* Ïä§ÌÅ¨Î°§Î∞î */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        @media (max-width: 1200px) {
            .sidebar {
                width: 100%;
                max-height: none;
                border-right: none;
                border-bottom: 1px solid #e5e5e5;
            }

            .content {
                padding: 20px;
            }

            .filters-wrapper {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }

            .main-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- ÏôºÏ™Ω Ìå®ÎÑê -->
        <div class="sidebar">
            <div class="sidebar-title">YouTube ÌÉêÏÉâÍ∏∞</div>

            <!-- API ÌÇ§ ÏÑπÏÖò -->
            <div class="api-section">
                <div class="api-label">API ÌÇ§ (localStorage: yt_api_key)</div>
                <input
                    type="password"
                    class="api-input"
                    id="apiKey"
                    placeholder="AlzaSyC2XwmVlXjWO14-P-fRggwHUsklsn-KQt8"
                >
                <div class="btn-group">
                    <button class="btn btn-delete" id="btnDelete">ÏßÄÏö∞Í∏∞</button>
                    <button class="btn btn-save" id="btnSave">Ï†ÄÏû•</button>
                </div>
            </div>

            <!-- Í≤ÄÏÉâ ÏÑπÏÖò -->
            <div class="search-section">
                <div class="search-label">Í≤ÄÏÉâÏñ¥</div>
                <input
                    type="text"
                    class="search-input"
                    id="searchInput"
                    placeholder=""
                >
            </div>

            <!-- ÌïÑÌÑ∞ ÏÑπÏÖò -->
            <div class="filters-wrapper">
                <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ -->
                <div class="filter-section">
                    <div class="filter-title">Í∏∞Í∞Ñ ÌïÑÌÑ∞</div>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="radio" name="uploadPeriod" value="all" checked>
                            <label>Ï†ÑÏ≤¥</label>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="uploadPeriod" value="1month">
                            <label>1Í∞úÏõî</label>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="uploadPeriod" value="2months">
                            <label>2Í∞úÏõî</label>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="uploadPeriod" value="6months">
                            <label>6Í∞úÏõî</label>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="uploadPeriod" value="1year">
                            <label>1ÎÖÑ</label>
                        </label>
                    </div>
                </div>

                <!-- Í∏∏Ïù¥ ÌïÑÌÑ∞ -->
                <div class="filter-section">
                    <div class="filter-title">Í∏∏Ïù¥ ÌïÑÌÑ∞</div>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="radio" name="videoLength" value="all" checked>
                            <label>Ï†ÑÏ≤¥</label>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="videoLength" value="short">
                            <label>ÏàèÌèº(<60Ï¥à)</label>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="videoLength" value="long">
                            <label>Î°±Ìèº(‚â•60Ï¥à)</label>
                        </label>
                    </div>
                </div>

                <!-- Íµ¨ÎèÖÏûê ÎåÄÎπÑ Ï°∞ÌöåÏàò ÎπÑÏú® ÌïÑÌÑ∞ -->
                <div class="engagement-section">
                    <div class="engagement-title">Íµ¨ÎèÖÏûê ÎåÄÎπÑ Ï°∞ÌöåÏàò ÎπÑÏú® Îã®Í≥Ñ(Îã§Ï§ëÏÑ†ÌÉù)</div>
                    <div class="engagement-info">Ï°∞ÌöåÏàò/Íµ¨ÎèÖÏûê ÎπÑÏú®Ïù¥ ÎÜíÏùÑÏàòÎ°ù Ï±ÑÎÑêÏùò Ïã§Ï†ú ÏòÅÌñ•Î†•Ïù¥ ÌÅº</div>
                    <div class="engagement-options">
                        <label class="filter-option">
                            <input type="checkbox" name="engagementRatio" value="all">
                            <label>Ï†ÑÏ≤¥</label>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="engagementRatio" value="1">
                            <label>1Îã®Í≥Ñ (<0.2)</label>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="engagementRatio" value="2">
                            <label>2Îã®Í≥Ñ (0.2~0.6)</label>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="engagementRatio" value="3">
                            <label>3Îã®Í≥Ñ (0.6~1.4)</label>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="engagementRatio" value="4" checked>
                            <label>4Îã®Í≥Ñ (1.4~3.0)</label>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="engagementRatio" value="5" checked>
                            <label>5Îã®Í≥Ñ (‚â•3.0)</label>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ïò§Î•∏Ï™Ω Ïª®ÌÖêÏ∏† ÏòÅÏó≠ -->
        <div class="content">
            <div class="content-header">
                <div class="content-title">Í≤ÄÏÉâÍ≤∞Í≥º</div>
                <div class="controls-right">
                    <div class="view-toggle">
                        <button class="view-btn active" id="btnCardView" data-view="card">üìá Ïπ¥Îìú</button>
                        <button class="view-btn" id="btnTableView" data-view="table">üìä ÌÖåÏù¥Î∏î</button>
                    </div>
                    <select class="sort-dropdown" id="sortDropdown">
                        <option value="relevance">Ï°∞ÌöåÏàò + ÎÇ¥Î¶ºÏ∞®Ïàú</option>
                        <option value="viewCount">Ï°∞ÌöåÏàò Í∏∞Ï§Ä</option>
                        <option value="publishedAt">ÏµúÏã†Ïàú</option>
                    </select>
                    <button class="btn-excel" id="btnExcel">üì• ÏóëÏÖÄ</button>
                    <button class="btn-search" id="searchBtn">Í≤ÄÏÉâ</button>
                </div>
            </div>

            <div id="resultsInfo" class="results-count"></div>
            <div id="errorContainer"></div>
            <div id="statusContainer" class="status"></div>

            <!-- Ïπ¥Îìú Î∑∞ -->
            <div class="results-grid" id="resultsContainer"></div>

            <!-- ÌÖåÏù¥Î∏î Î∑∞ -->
            <div class="results-table-wrapper" id="tableWrapper">
                <table class="results-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th>Ïç∏ÎÑ§Ïùº</th>
                            <th>Ï†úÎ™©</th>
                            <th>Ï±ÑÎÑêÎ™Ö</th>
                            <th>Ï°∞ÌöåÏàò</th>
                            <th>Íµ¨ÎèÖÏûê</th>
                            <th>ÎπÑÏú®</th>
                            <th>Îã®Í≥Ñ</th>
                            <th>Í∏∏Ïù¥</th>
                            <th>ÏóÖÎ°úÎìú</th>
                            <th>ÎßÅÌÅ¨</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const API_KEY_INPUT = document.getElementById('apiKey');
        const SEARCH_INPUT = document.getElementById('searchInput');
        const SEARCH_BTN = document.getElementById('searchBtn');
        const BTN_SAVE = document.getElementById('btnSave');
        const BTN_DELETE = document.getElementById('btnDelete');
        const BTN_CARD_VIEW = document.getElementById('btnCardView');
        const BTN_TABLE_VIEW = document.getElementById('btnTableView');
        const BTN_EXCEL = document.getElementById('btnExcel');
        const SORT_DROPDOWN = document.getElementById('sortDropdown');
        const RESULTS_CONTAINER = document.getElementById('resultsContainer');
        const TABLE_WRAPPER = document.getElementById('tableWrapper');
        const TABLE_BODY = document.getElementById('tableBody');
        const RESULTS_INFO = document.getElementById('resultsInfo');
        const STATUS_CONTAINER = document.getElementById('statusContainer');
        const ERROR_CONTAINER = document.getElementById('errorContainer');

        const YOUTUBE_API_URL = 'https://www.googleapis.com/youtube/v3';
        const MAX_RESULTS = 30;

        let allVideosData = [];
        let allChannelsData = {};
        let currentView = 'card';

        // LocalStorage Î°úÎìú
        function loadFromLocalStorage() {
            const savedKey = localStorage.getItem('yt_api_key');
            const savedQuery = localStorage.getItem('yt_search_query');
            if (savedKey) API_KEY_INPUT.value = savedKey;
            if (savedQuery) SEARCH_INPUT.value = savedQuery;
        }

        loadFromLocalStorage();

        // Î∑∞ Ï†ÑÌôò
        BTN_CARD_VIEW.addEventListener('click', () => {
            currentView = 'card';
            BTN_CARD_VIEW.classList.add('active');
            BTN_TABLE_VIEW.classList.remove('active');
            RESULTS_CONTAINER.classList.remove('hidden');
            TABLE_WRAPPER.classList.remove('active');
        });

        BTN_TABLE_VIEW.addEventListener('click', () => {
            currentView = 'table';
            BTN_TABLE_VIEW.classList.add('active');
            BTN_CARD_VIEW.classList.remove('active');
            RESULTS_CONTAINER.classList.add('hidden');
            TABLE_WRAPPER.classList.add('active');
        });

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        SEARCH_BTN.addEventListener('click', handleSearch);
        BTN_SAVE.addEventListener('click', saveSettings);
        BTN_DELETE.addEventListener('click', deleteSettings);
        BTN_EXCEL.addEventListener('click', downloadExcel);
        SEARCH_INPUT.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSearch();
        });
        SORT_DROPDOWN.addEventListener('change', refilterResults);

        // ÌïÑÌÑ∞ Î≥ÄÍ≤Ω Ïãú ÏûêÎèô Ïû¨ÌïÑÌÑ∞ÎßÅ
        document.querySelectorAll('input[name="uploadPeriod"], input[name="videoLength"], input[name="engagementRatio"]').forEach(input => {
            input.addEventListener('change', refilterResults);
        });

        function saveSettings() {
            localStorage.setItem('yt_api_key', API_KEY_INPUT.value);
            localStorage.setItem('yt_search_query', SEARCH_INPUT.value);
            alert('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
        }

        function deleteSettings() {
            localStorage.removeItem('yt_api_key');
            localStorage.removeItem('yt_search_query');
            API_KEY_INPUT.value = '';
            SEARCH_INPUT.value = '';
            alert('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
        }

        async function handleSearch() {
            const searchQuery = SEARCH_INPUT.value.trim();
            const apiKey = API_KEY_INPUT.value.trim();

            if (!searchQuery) {
                showError('Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                return;
            }

            if (!apiKey) {
                showError('API ÌÇ§Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                return;
            }

            await searchVideos(searchQuery, apiKey);
        }

        async function searchVideos(query, apiKey) {
            try {
                setStatus('Í≤ÄÏÉâ Ï§ë...');
                SEARCH_BTN.disabled = true;
                clearResults();
                clearError();

                const searchResponse = await fetch(
                    `${YOUTUBE_API_URL}/search?part=snippet&q=${encodeURIComponent(query)}&maxResults=${MAX_RESULTS}&type=video&key=${apiKey}`
                );

                if (!searchResponse.ok) {
                    throw new Error('Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. API ÌÇ§Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
                }

                const searchData = await searchResponse.json();

                if (!searchData.items || searchData.items.length === 0) {
                    showNoResults('Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§');
                    return;
                }

                const videoIds = searchData.items.map(item => item.id.videoId).join(',');
                setStatus('ÏòÅÏÉÅ Ï†ïÎ≥¥ Ï°∞Ìöå Ï§ë...');

                const detailsResponse = await fetch(
                    `${YOUTUBE_API_URL}/videos?part=snippet,statistics,contentDetails&id=${videoIds}&key=${apiKey}`
                );

                if (!detailsResponse.ok) {
                    throw new Error('ÏòÅÏÉÅ Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
                }

                const detailsData = await detailsResponse.json();
                allVideosData = detailsData.items;

                setStatus('Ï±ÑÎÑê Ï†ïÎ≥¥ Ï°∞Ìöå Ï§ë...');

                const channelIds = [...new Set(detailsData.items.map(video => video.snippet.channelId))];
                allChannelsData = {};

                for (let i = 0; i < channelIds.length; i += 50) {
                    const chunk = channelIds.slice(i, i + 50).join(',');
                    const channelResponse = await fetch(
                        `${YOUTUBE_API_URL}/channels?part=statistics&id=${chunk}&key=${apiKey}`
                    );

                    if (!channelResponse.ok) {
                        throw new Error('Ï±ÑÎÑê Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
                    }

                    const channelData = await channelResponse.json();
                    channelData.items.forEach(channel => {
                        allChannelsData[channel.id] = channel.statistics;
                    });
                }

                refilterResults();
                setStatus('');

            } catch (error) {
                console.error('ÏóêÎü¨:', error);
                showError(error.message || 'Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§');
                setStatus('');
            } finally {
                SEARCH_BTN.disabled = false;
            }
        }

        function refilterResults() {
            if (allVideosData.length === 0) {
                return;
            }

            const uploadPeriod = document.querySelector('input[name="uploadPeriod"]:checked').value;
            const videoLength = document.querySelector('input[name="videoLength"]:checked').value;
            const engagementRatios = Array.from(document.querySelectorAll('input[name="engagementRatio"]:checked')).map(el => el.value);

            let filtered = allVideosData.filter(video => {
                if (videoLength !== 'all') {
                    const duration = parseDuration(video.contentDetails.duration);
                    if (videoLength === 'short' && duration >= 60) return false;
                    if (videoLength === 'long' && duration < 60) return false;
                }

                if (uploadPeriod !== 'all') {
                    const uploadDate = new Date(video.snippet.publishedAt);
                    const now = new Date();
                    const daysAgo = (now - uploadDate) / (1000 * 60 * 60 * 24);

                    if (uploadPeriod === '1month' && daysAgo > 30) return false;
                    if (uploadPeriod === '2months' && daysAgo > 60) return false;
                    if (uploadPeriod === '6months' && daysAgo > 180) return false;
                    if (uploadPeriod === '1year' && daysAgo > 365) return false;
                }

                if (engagementRatios.length > 0 && !engagementRatios.includes('all')) {
                    const ratio = calculateEngagementRatio(video);
                    const level = getEngagementLevel(ratio);
                    if (!engagementRatios.includes(level.toString())) return false;
                }

                return true;
            });

            const sortType = SORT_DROPDOWN.value;
            filtered = sortResults(filtered, sortType);

            displayResults(filtered, uploadPeriod, videoLength, engagementRatios);
        }

        function sortResults(videos, sortType) {
            const sorted = [...videos];
            switch (sortType) {
                case 'viewCount':
                    sorted.sort((a, b) => parseInt(b.statistics.viewCount) - parseInt(a.statistics.viewCount));
                    break;
                case 'publishedAt':
                    sorted.sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
                    break;
                case 'relevance':
                default:
                    sorted.sort((a, b) => {
                        const viewA = parseInt(a.statistics.viewCount) || 0;
                        const viewB = parseInt(b.statistics.viewCount) || 0;
                        return viewB - viewA;
                    });
            }
            return sorted;
        }

        function parseDuration(duration) {
            const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
            const hours = parseInt(match[1]) || 0;
            const minutes = parseInt(match[2]) || 0;
            const seconds = parseInt(match[3]) || 0;
            return hours * 3600 + minutes * 60 + seconds;
        }

        function calculateEngagementRatio(video) {
            const viewCount = parseInt(video.statistics.viewCount) || 0;
            const channelStats = allChannelsData[video.snippet.channelId];
            const subscriberCount = channelStats ? parseInt(channelStats.subscriberCount) || 0 : 0;

            if (subscriberCount === 0) return 0;
            return viewCount / subscriberCount;
        }

        function getEngagementLevel(ratio) {
            if (ratio >= 3.0) return 5;
            if (ratio >= 1.4) return 4;
            if (ratio >= 0.6) return 3;
            if (ratio >= 0.2) return 2;
            return 1;
        }

        function displayResults(filtered, uploadPeriod, videoLength, engagementRatios) {
            RESULTS_CONTAINER.innerHTML = '';
            TABLE_BODY.innerHTML = '';

            if (filtered.length === 0) {
                showNoResults('Ï°∞Í±¥Ïóê ÎßûÎäî ÏòÅÏÉÅÏù¥ ÏóÜÏäµÎãàÎã§');
                return;
            }

            showResultsInfo(filtered.length, uploadPeriod, videoLength, engagementRatios);

            filtered.forEach(video => {
                // Ïπ¥Îìú Î∑∞Ïö©
                const card = createVideoCard(video);
                RESULTS_CONTAINER.appendChild(card);

                // ÌÖåÏù¥Î∏î Î∑∞Ïö©
                const row = createTableRow(video);
                TABLE_BODY.appendChild(row);
            });
        }

        function showResultsInfo(count, uploadPeriod, videoLength, engagementRatios) {
            const texts = [];

            if (videoLength !== 'all') {
                texts.push(videoLength === 'short' ? 'ÏàèÌèº' : 'Î°±Ìèº');
            }

            if (uploadPeriod !== 'all') {
                const periodMap = {
                    '1month': '1Í∞úÏõî',
                    '2months': '2Í∞úÏõî',
                    '6months': '6Í∞úÏõî',
                    '1year': '1ÎÖÑ'
                };
                texts.push(periodMap[uploadPeriod] || uploadPeriod);
            }

            const filterText = texts.length > 0 ? ` - ${texts.join(', ')}` : '';
            RESULTS_INFO.textContent = `Í≤ÄÏÉâÍ≤∞Í≥º ${count}Í∞ú${filterText}`;
        }

        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card';

            const videoId = video.id;
            const snippet = video.snippet;
            const stats = video.statistics;
            const contentDetails = video.contentDetails;

            const title = snippet.title;
            const channel = snippet.channelTitle;
            const thumbnail = snippet.thumbnails.medium.url;
            const videoLink = `https://www.youtube.com/watch?v=${videoId}`;
            const tags = snippet.tags ? snippet.tags.slice(0, 2) : [];

            const viewCount = parseInt(stats.viewCount) || 0;
            const channelStats = allChannelsData[snippet.channelId];
            const subscriberCount = channelStats ? parseInt(channelStats.subscriberCount) || 0 : 0;
            const engagementRatioValue = calculateEngagementRatio(video);
            const engagementLevel = getEngagementLevel(engagementRatioValue);
            const duration = parseDuration(contentDetails.duration);

            const viewCountText = formatNumber(viewCount);
            const subscriberText = subscriberCount > 0 ? formatNumber(subscriberCount) : 'ÎØ∏Í≥µÍ∞ú';
            const ratioText = subscriberCount > 0 ? engagementRatioValue.toFixed(2) : 'N/A';
            const durationText = formatDuration(duration);

            let tagsHTML = '';
            if (tags.length > 0) {
                tagsHTML = tags.map(tag => `<div class="tag">${escapeHtml(tag)}</div>`).join('');
            }

            const badgeClass = `engagement-badge engagement-${engagementLevel}`;

            card.innerHTML = `
                <div style="position: relative;">
                    <img src="${escapeHtml(thumbnail)}" alt="${escapeHtml(title)}" class="video-thumbnail">
                    <div class="video-duration">${durationText}</div>
                </div>
                <div class="video-info">
                    <div class="video-title">${escapeHtml(title)}</div>
                    <div class="video-channel">${escapeHtml(channel)}</div>
                    <div class="video-stats">
                        <div class="stat-item">üëÅÔ∏è ${viewCountText}</div>
                        <div class="stat-item">üì∫ ${subscriberText}</div>
                    </div>
                    <div class="video-stats">
                        <div class="stat-item">üìä ${ratioText}</div>
                    </div>
                    <div class="${badgeClass}">${engagementLevel}Îã®Í≥Ñ</div>
                    <div class="video-tags">${tagsHTML}</div>
                    <a href="${videoLink}" target="_blank" class="video-link">YouTubeÏóêÏÑú Î≥¥Í∏∞ ‚Üí</a>
                </div>
            `;

            return card;
        }

        function createTableRow(video) {
            const row = document.createElement('tr');

            const videoId = video.id;
            const snippet = video.snippet;
            const stats = video.statistics;
            const contentDetails = video.contentDetails;

            const title = snippet.title;
            const channel = snippet.channelTitle;
            const thumbnail = snippet.thumbnails.medium.url;
            const videoLink = `https://www.youtube.com/watch?v=${videoId}`;

            const viewCount = parseInt(stats.viewCount) || 0;
            const channelStats = allChannelsData[snippet.channelId];
            const subscriberCount = channelStats ? parseInt(channelStats.subscriberCount) || 0 : 0;
            const engagementRatioValue = calculateEngagementRatio(video);
            const engagementLevel = getEngagementLevel(engagementRatioValue);
            const duration = parseDuration(contentDetails.duration);
            const uploadDate = new Date(snippet.publishedAt).toLocaleDateString('ko-KR');

            const viewCountText = formatNumber(viewCount);
            const subscriberText = subscriberCount > 0 ? formatNumber(subscriberCount) : 'ÎØ∏Í≥µÍ∞ú';
            const ratioText = subscriberCount > 0 ? engagementRatioValue.toFixed(2) : 'N/A';
            const durationText = formatDuration(duration);
            const badgeClass = `engagement-badge engagement-${engagementLevel}`;

            row.innerHTML = `
                <td><img src="${escapeHtml(thumbnail)}" alt="${escapeHtml(title)}" class="table-thumbnail"></td>
                <td class="table-title">${escapeHtml(title)}</td>
                <td>${escapeHtml(channel)}</td>
                <td>${viewCountText}</td>
                <td>${subscriberText}</td>
                <td>${ratioText}</td>
                <td><span class="${badgeClass}">${engagementLevel}Îã®Í≥Ñ</span></td>
                <td>${durationText}</td>
                <td>${uploadDate}</td>
                <td><a href="${videoLink}" target="_blank" class="table-link">Î≥¥Í∏∞</a></td>
            `;

            return row;
        }

        function downloadExcel() {
            if (allVideosData.length === 0) {
                alert('Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§');
                return;
            }

            // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞ ÏñªÍ∏∞
            const uploadPeriod = document.querySelector('input[name="uploadPeriod"]:checked').value;
            const videoLength = document.querySelector('input[name="videoLength"]:checked').value;
            const engagementRatios = Array.from(document.querySelectorAll('input[name="engagementRatio"]:checked')).map(el => el.value);

            let filtered = allVideosData.filter(video => {
                if (videoLength !== 'all') {
                    const duration = parseDuration(video.contentDetails.duration);
                    if (videoLength === 'short' && duration >= 60) return false;
                    if (videoLength === 'long' && duration < 60) return false;
                }

                if (uploadPeriod !== 'all') {
                    const uploadDate = new Date(video.snippet.publishedAt);
                    const now = new Date();
                    const daysAgo = (now - uploadDate) / (1000 * 60 * 60 * 24);

                    if (uploadPeriod === '1month' && daysAgo > 30) return false;
                    if (uploadPeriod === '2months' && daysAgo > 60) return false;
                    if (uploadPeriod === '6months' && daysAgo > 180) return false;
                    if (uploadPeriod === '1year' && daysAgo > 365) return false;
                }

                if (engagementRatios.length > 0 && !engagementRatios.includes('all')) {
                    const ratio = calculateEngagementRatio(video);
                    const level = getEngagementLevel(ratio);
                    if (!engagementRatios.includes(level.toString())) return false;
                }

                return true;
            });

            // CSV Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            const csvHeader = ['Ï†úÎ™©', 'Ï±ÑÎÑêÎ™Ö', 'Ï°∞ÌöåÏàò', 'Íµ¨ÎèÖÏûê', 'Ï°∞ÌöåÏàò/Íµ¨ÎèÖÏûê', 'Îã®Í≥Ñ', 'ÏòÅÏÉÅÍ∏∏Ïù¥', 'ÏóÖÎ°úÎìúÏùº', 'ÌÉúÍ∑∏', 'YouTubeÎßÅÌÅ¨'];
            const csvRows = [];

            filtered.forEach(video => {
                const videoId = video.id;
                const snippet = video.snippet;
                const stats = video.statistics;
                const contentDetails = video.contentDetails;

                const title = snippet.title;
                const channel = snippet.channelTitle;
                const tags = snippet.tags ? snippet.tags.join(';') : '';
                const videoLink = `https://www.youtube.com/watch?v=${videoId}`;

                const viewCount = parseInt(stats.viewCount) || 0;
                const channelStats = allChannelsData[snippet.channelId];
                const subscriberCount = channelStats ? parseInt(channelStats.subscriberCount) || 0 : 0;
                const engagementRatioValue = calculateEngagementRatio(video);
                const engagementLevel = getEngagementLevel(engagementRatioValue);
                const duration = parseDuration(contentDetails.duration);
                const uploadDate = new Date(snippet.publishedAt).toLocaleDateString('ko-KR');
                const durationText = formatDuration(duration);

                const ratioText = subscriberCount > 0 ? engagementRatioValue.toFixed(2) : 'N/A';

                csvRows.push([
                    `"${title.replace(/"/g, '""')}"`,
                    `"${channel.replace(/"/g, '""')}"`,
                    viewCount,
                    subscriberCount,
                    ratioText,
                    engagementLevel,
                    durationText,
                    uploadDate,
                    `"${tags.replace(/"/g, '""')}"`,
                    videoLink
                ]);
            });

            // CSV Î¨∏ÏûêÏó¥ ÏÉùÏÑ±
            const csv = [csvHeader.join(','), ...csvRows.map(row => row.join(','))].join('\n');

            // Îã§Ïö¥Î°úÎìú
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `youtube-search-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function formatDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;

            if (hours > 0) {
                return `${hours}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }
            return `${minutes}:${String(secs).padStart(2, '0')}`;
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function setStatus(message) {
            STATUS_CONTAINER.innerHTML = message ? `<div class="loading-spinner"></div> ${message}` : '';
        }

        function showError(message) {
            ERROR_CONTAINER.innerHTML = `<div class="error-message">‚ö†Ô∏è ${message}</div>`;
        }

        function clearError() {
            ERROR_CONTAINER.innerHTML = '';
        }

        function clearResults() {
            RESULTS_CONTAINER.innerHTML = '';
            TABLE_BODY.innerHTML = '';
            RESULTS_INFO.textContent = '';
        }

        function showNoResults(message) {
            RESULTS_CONTAINER.innerHTML = `<div class="no-results">${message}</div>`;
            RESULTS_INFO.textContent = '';
        }

        SEARCH_INPUT.focus();
    </script>
</body>
</html>
